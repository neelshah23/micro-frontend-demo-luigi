!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LuigiClient=t():e.LuigiClient=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promises={}}var t,n,i;return t=e,(n=[{key:"setPromise",value:function(e,t){this.promises[e]=t}},{key:"getPromise",value:function(e){return this.promises[e]}}])&&o(t.prototype,n),i&&o(t,i),e}();function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=[],this.origin="";var t=function(e){if(e.data.msg)if("custom"===e.data.msg){var t=this.convertCustomMessageInternalToUser(e.data);this.listeners.filter(function(e){return e.name===t.id}).map(function(e){return e.eventFn(t,e.listenerId)})}else this.listeners.filter(function(t){return t.name===e.data.msg}).map(function(t){return t.eventFn(e,t.listenerId)})}.bind(this);window.addEventListener("message",t),window.onunload=function(){return window.removeEventListener("message",t)}}var t,n,o;return t=e,(n=[{key:"convertCustomMessageInternalToUser",value:function(e){return e.data}},{key:"convertCustomMessageUserToInternal",value:function(e){return{msg:"custom",data:e}}},{key:"addEventListener",value:function(e,t){var n=this.getRandomId();return this.listeners.push({name:e,eventFn:t,listenerId:n}),n}},{key:"removeEventListener",value:function(e){return!!Boolean(this.listeners.find(function(t){return t.listenerId===e}))&&(this.listeners=this.listeners.filter(function(t){return t.listenerId!==e}),!0)}},{key:"getRandomId",value:function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"getLuigiCoreDomain",value:function(){return this.origin}},{key:"setLuigiCoreDomain",value:function(e){e&&(this.origin=e)}},{key:"sendPostMessageToLuigiCore",value:function(e){window.parent.postMessage(e,this.origin)}}])&&r(t.prototype,n),o&&r(t,o),e}());function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=new(function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=l(this,c(t).call(this))).luigiInitialized=!1,e.defaultContextKeys=["context","internal","nodeParams","pathParams"],e.setCurrentContext(e.defaultContextKeys.reduce(function(e,t){return e[t]={},e},{})),e._onContextUpdatedFns={},e._onInitFns={},e.authData={};var n,o;return n=function(t){for(var n=0;n<e.defaultContextKeys.length;n++){var o=e.defaultContextKeys[n];try{"string"==typeof t[o]&&(t[o]=JSON.parse(t[o]))}catch(e){console.info("unable to parse luigi context data for",o,t[o],e)}}e.setCurrentContext(t)},o=function(t){t&&(e.authData=t)},a.addEventListener("luigi.init",function(t){n(t.data),o(t.data.authData),a.setLuigiCoreDomain(t.origin),e.luigiInitialized=!0,e._notifyInit(t.origin)}),a.addEventListener("luigi.auth.tokenIssued",function(e){o(e.data.authData)}),a.addEventListener("luigi.navigate",function(t){n(t.data),e.currentContext.internal.isNavigateBack||(history.replaceState(null,"",t.data.viewUrl),window.dispatchEvent(new PopStateEvent("popstate",{state:"luiginavigation"}))),e._notifyUpdate(),a.sendPostMessageToLuigiCore({msg:"luigi.navigate.ok"})}),window.parent.postMessage({msg:"luigi.get-context"},"*"),e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,i),n=t,(o=[{key:"_callAllFns",value:function(e,t,n){for(var o in e)e.hasOwnProperty(o)&&a.isFunction(e[o])&&e[o](t,n)}},{key:"_notifyInit",value:function(e){this._callAllFns(this._onInitFns,this.currentContext.context,e)}},{key:"_notifyUpdate",value:function(){this._callAllFns(this._onContextUpdatedFns,this.currentContext.context)}},{key:"setCurrentContext",value:function(e){this.currentContext=e}},{key:"addInitListener",value:function(e){var t=a.getRandomId();return this._onInitFns[t]=e,this.luigiInitialized&&a.isFunction(e)&&e(this.currentContext.context,a.getLuigiCoreDomain()),t}},{key:"removeInitListener",value:function(e){return!!this._onInitFns[e]&&(this._onInitFns[e]=void 0,!0)}},{key:"addContextUpdateListener",value:function(e){var t=a.getRandomId();return this._onContextUpdatedFns[t]=e,this.luigiInitialized&&a.isFunction(e)&&e(this.currentContext.context),t}},{key:"removeContextUpdateListener",value:function(e){return!!this._onContextUpdatedFns[e]&&(this._onContextUpdatedFns[e]=void 0,!0)}},{key:"addCustomMessageListener",value:function(e,t){return a.addEventListener(e,function(e,n){return t(e,n)})}},{key:"removeCustomMessageListener",value:function(e){return a.removeEventListener(e)}},{key:"getToken",value:function(){return this.authData.accessToken}},{key:"getEventData",value:function(){return this.currentContext.context}},{key:"getContext",value:function(){return this.getEventData()}},{key:"getNodeParams",value:function(){return this.currentContext.nodeParams}},{key:"getPathParams",value:function(){return this.currentContext.pathParams}},{key:"getClientPermissions",value:function(){return this.currentContext.internal.clientPermissions||{}}},{key:"sendCustomMessage",value:function(e){var t=a.convertCustomMessageUserToInternal(e);a.sendPostMessageToLuigiCore(t)}}])&&u(n.prototype,o),r&&u(n,r),t}());function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=y(this,g(t).call(this))).validSplitViewEvents=["expand","collapse","resize","close"],n.splitView={exists:!0,size:40,collapsed:!1},Object.assign(n.splitView,e);return n.splitView.listeners=[a.addEventListener("luigi.navigation.splitview.internal",function(e){Object.assign(n.splitView,e.data.data)})],n.on("resize",function(e){n.splitView.size=e}),n.on("close",function(){n.splitView.listeners.forEach(function(e){return a.removeEventListener(e)})}),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,i),n=t,(o=[{key:"sendSplitViewEvent",value:function(e,t){a.sendPostMessageToLuigiCore({msg:"luigi.navigation.splitview.".concat(e),data:t})}},{key:"collapse",value:function(){this.sendSplitViewEvent("collapse")}},{key:"expand",value:function(){this.sendSplitViewEvent("expand")}},{key:"close",value:function(){this.sendSplitViewEvent("close")}},{key:"setSize",value:function(e){this.sendSplitViewEvent("resize",e)}},{key:"on",value:function(e,t){if(!this.validSplitViewEvents.includes(e))return console.warn(e+" is not a valid split view event"),!1;var n=a.addEventListener("luigi.navigation.splitview.".concat(e,".ok"),function(e){return t(e.data.data)});return this.splitView.listeners.push(n),n}},{key:"removeEventListener",value:function(e){return a.removeEventListener(e)}},{key:"exists",value:function(){return this.splitView.exists}},{key:"getSize",value:function(){return this.splitView.size}},{key:"isCollapsed",value:function(){return this.splitView.collapsed}},{key:"isExpanded",value:function(){return!this.splitView.collapsed}}])&&p(n.prototype,o),r&&p(n,r),t}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(e){var n,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(i=C(t).call(this))||"object"!==b(i)&&"function"!=typeof i?k(o):i,Object.assign(k(n),e),n.options={preserveView:!1,nodeParams:{},errorSkipNavigation:!1,fromContext:null,fromClosestContext:!1,relative:!1,link:""},n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,i),n=t,(o=[{key:"navigate",value:function(e,t,n,o,i){if(this.options.errorSkipNavigation)this.options.errorSkipNavigation=!1;else{o&&i&&console.warn("modalSettings and splitViewSettings cannot be used together. Only modal setting will be taken into account."),this.options.preserveView=n;var r="/"!==e[0],s={msg:"luigi.navigation.open",sessionId:t,params:Object.assign(this.options,{link:e,relative:r,modal:o,splitView:i})};a.sendPostMessageToLuigiCore(s)}}},{key:"openAsModal",value:function(e,t){this.navigate(e,0,!0,t||{})}},{key:"openAsSplitView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.navigate(e,0,!0,void 0,t),new h(t)}},{key:"fromContext",value:function(e){return-1!==this.currentContext.context.parentNavigationContexts.indexOf(e)?this.options.fromContext=e:(this.options.errorSkipNavigation=!0,console.error("Navigation not possible, navigationContext "+e+" not found.")),this}},{key:"fromClosestContext",value:function(){return this.currentContext.context.parentNavigationContexts.length>0?(this.options.fromContext=null,this.options.fromClosestContext=!0):console.error("Navigation not possible, no parent navigationContext found."),this}},{key:"withParams",value:function(e){return e&&Object.assign(this.options.nodeParams,e),this}},{key:"pathExists",value:function(e){var t=Date.now(),n=this.getPromise("pathExistsPromises")||{};n[t]={resolveFn:function(){},then:function(e){this.resolveFn=e}},this.setPromise("pathExistsPromises",n),a.addEventListener("luigi.navigation.pathExists.answer",function(e,t){var n=e.data.data,o=this.getPromise("pathExistsPromises")||{};o[n.correlationId]&&(o[n.correlationId].resolveFn(n.pathExists),delete o[n.correlationId],this.setPromise("pathExistsPromises",o)),a.removeEventListener(t)}.bind(this));var o={msg:"luigi.navigation.pathExists",data:{id:t,link:e,relative:"/"!==e[0]}};return a.sendPostMessageToLuigiCore(o),n[t]}},{key:"hasBack",value:function(){return!!this.currentContext.internal.modal||0!==this.currentContext.internal.viewStackSize}},{key:"goBack",value:function(e){a.sendPostMessageToLuigiCore({msg:"luigi.navigation.back",goBackContext:e&&JSON.stringify(e)})}}])&&w(n.prototype,o),r&&w(n,r),t}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function E(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=E(this,_(t).call(this)),a.addEventListener("luigi.current-locale-changed",function(e){var t;e.data.currentLocale&&(null===(t=d.currentContext)||void 0===t?void 0:t.internal)&&(d.currentContext.internal.currentLocale=e.data.currentLocale,d._notifyUpdate())}),e}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,i),n=t,(o=[{key:"showLoadingIndicator",value:function(){a.sendPostMessageToLuigiCore({msg:"luigi.show-loading-indicator"})}},{key:"hideLoadingIndicator",value:function(){a.sendPostMessageToLuigiCore({msg:"luigi.hide-loading-indicator"})}},{key:"addBackdrop",value:function(){a.sendPostMessageToLuigiCore({msg:"luigi.add-backdrop"})}},{key:"removeBackdrop",value:function(){a.sendPostMessageToLuigiCore({msg:"luigi.remove-backdrop"})}},{key:"setDirtyStatus",value:function(e){a.sendPostMessageToLuigiCore({msg:"luigi.set-page-dirty",dirty:e})}},{key:"showConfirmationModal",value:function(e){var t=this;a.addEventListener("luigi.ux.confirmationModal.hide",function(e,n){t.hideConfirmationModal(e.data.data),a.removeEventListener(n)}),a.sendPostMessageToLuigiCore({msg:"luigi.ux.confirmationModal.show",data:{settings:e}});var n={};return n.promise=new Promise(function(e,t){n.resolveFn=e,n.rejectFn=t}),this.setPromise("confirmationModal",n),n.promise}},{key:"hideConfirmationModal",value:function(e){var t=this.getPromise("confirmationModal");t&&(e.confirmed?t.resolveFn():t.rejectFn(),this.setPromise("confirmationModal",void 0))}},{key:"showAlert",value:function(e){var t=this;a.addEventListener("luigi.ux.alert.hide",function(e,n){t.hideAlert(e.data.id),a.removeEventListener(n)}),e.id=a.getRandomId(),(null==e?void 0:e.closeAfter)<100&&(console.warn("Message with id='".concat(e.id,"' has too small 'closeAfter' value. It needs to be at least 100ms.")),e.closeAfter=void 0),a.sendPostMessageToLuigiCore({msg:"luigi.ux.alert.show",data:{settings:e}});var n=this.getPromise("alerts")||{};return n[e.id]={},n[e.id].promise=new Promise(function(t){n[e.id].resolveFn=t}),this.setPromise("alerts",n),n[e.id].promise}},{key:"hideAlert",value:function(e){var t=this.getPromise("alerts");e&&t[e]&&(t[e].resolveFn(e),delete t[e],this.setPromise("alerts",t))}},{key:"getCurrentLocale",value:function(){var e,t;return null===(e=d.currentContext)||void 0===e?void 0:null===(t=e.internal)||void 0===t?void 0:t.currentLocale}},{key:"setCurrentLocale",value:function(e){e&&a.sendPostMessageToLuigiCore({msg:"luigi.ux.set-current-locale",data:{currentLocale:e}})}},{key:"isSplitView",value:function(){var e,t;return null===(e=d.currentContext)||void 0===e?void 0:null===(t=e.internal)||void 0===t?void 0:t.splitView}},{key:"isModal",value:function(){var e,t;return null===(e=d.currentContext)||void 0===e?void 0:null===(t=e.internal)||void 0===t?void 0:t.modal}}])&&O(n.prototype,o),r&&O(n,r),t}());function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"addInitListener",value:function(e){return d.addInitListener(e)}},{key:"removeInitListener",value:function(e){return d.removeInitListener(e)}},{key:"addContextUpdateListener",value:function(e){return d.addContextUpdateListener(e)}},{key:"removeContextUpdateListener",value:function(e){return d.removeContextUpdateListener(e)}},{key:"getToken",value:function(){return d.getToken()}},{key:"getEventData",value:function(){return d.getEventData()}},{key:"getContext",value:function(){return d.getContext()}},{key:"getNodeParams",value:function(){return d.getNodeParams()}},{key:"getPathParams",value:function(){return d.getPathParams()}},{key:"getClientPermissions",value:function(){return d.getClientPermissions()}},{key:"sendCustomMessage",value:function(e){return d.sendCustomMessage(e)}},{key:"addCustomMessageListener",value:function(e,t){return d.addCustomMessageListener(e,t)}},{key:"removeCustomMessageListener",value:function(e){return d.removeCustomMessageListener(e)}},{key:"linkManager",value:function(){return new P({currentContext:d.currentContext})}},{key:"uxManager",value:function(){return j}},{key:"lifecycleManager",value:function(){return d}}])&&M(t.prototype,n),o&&M(t,o),e}();t.default=I=new I}]).default});